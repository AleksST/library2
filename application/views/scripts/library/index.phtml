<?php foreach ($this->libraries as $library): ?>
    <div>
        <label> NAME : <?= $library->name; ?> </label>
        <label> ID : <?= $library->id; ?> </label>
        <a href="/library/update/?id=<?= $library->id; ?>">редактировать</a>
        <?php foreach ($this->branches[$library->id] as $branch) : ?>
        <div>   
            <label> BRANCH : <?= $branch->name; ?> </label>
            <label> ID : <?= $branch->id; ?> </label>
        </div>
        <?php endforeach; ?>
    </div>
<?php endforeach; ?>

<?php 
if(is_array($this->errors)) {
    foreach ($this->errors['subform'] as $name=>$error){
        if(count($error)){
            echo 'ошибка в поле ' . $name .': ' . implode('; ', $error) . '<br />';
        }
    }
}

if(!empty($this->library)) {
    $this->form->setDefaults($this->library->toArray());
    $this->form->subform->removeElement('addBtn');
    $this->form->subform->removeElement('searchBtn');
} else {
    $this->form->subform->removeElement('deleteBtn');
    $this->form->subform->removeElement('updateBtn');
}
echo $this->form->render();
?>